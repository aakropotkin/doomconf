#! /bin/sh
# -*- mode: sh; sh-shell: sh; -*-
# ============================================================================ #
#
#
#
# ---------------------------------------------------------------------------- #

set -eu;


# ---------------------------------------------------------------------------- #

: "${USE_CLIENT=}";
: "${EMACSCLIENT:=emacsclient}";
: "${EMACS:=emacs}";
: "${GREP:=grep}";

_EMACS_CMD=;


# ---------------------------------------------------------------------------- #

daemon_running_p() {
  ${EMACSCLIENT:?} -n -e "(if (> (length (frame-list)) 1) 't)" 2>/dev/null  \
    |${GREP:?} -q '^t$';
}


# ---------------------------------------------------------------------------- #

if test "$USE_CLIENT"; then
  _EMACS_CMD="${EMACSCLIENT:?}";
  set -- -nqc "$@";
  if daemon_running_p; then
    set -- -a '' "$@";
  fi
else
  _EMACS_CMD="${EMACS:?}";
fi

exec ${_EMACS_CMD:?} "$@" 2>/dev/null 1>/dev/null;


# ---------------------------------------------------------------------------- #
#
#
#
# ============================================================================ #
# vim: set filetype=sh :
